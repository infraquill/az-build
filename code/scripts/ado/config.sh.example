#!/bin/bash
# =============================================================================
# Configuration File Template
# =============================================================================
# Copy this file to config.sh and fill in your values.
# config.sh is gitignored and should never be committed.
#
# Usage:
#   cp config.sh.example config.sh
#   # Edit config.sh with your values
#   bash check-prerequisites.sh   # Verify configuration
#   bash create-variable-groups.sh  # Create Azure DevOps variable groups
# =============================================================================
# Note: This file does not use 'set -euo pipefail' because it is sourced
# by other scripts. The sourcing scripts handle error checking.

# =============================================================================
# Azure Active Directory / Entra ID Configuration
# =============================================================================
# Your Azure AD tenant ID (GUID format)
# Find via: az account show --query tenantId -o tsv
export AAD_TENANT_ID=""

# Platform Admin Service Principal name
# This is the display name for the app registration and service principal (e.g., sp-landing-zone-admin)
export PLATFORM_ADMIN_SP_NAME=""

# =============================================================================
# Azure DevOps Configuration
# =============================================================================
# Personal Access Token (PAT)
# Create at: https://dev.azure.com/{organization}/_usersSettings/tokens
#
# Required PAT Permissions:
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Scope                      │ Permission      │ Purpose                             │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ Variable Groups            │ Read & Manage   │ Create/update variable groups       │
# │ (under Pipelines)          │                 │                                     │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ Environment                │ Read & Manage   │ Create deployment environments      │
# │ (under Pipelines)          │                 │                                     │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ Project and Team           │ Read            │ List projects, verify access        │
# │ (under Project)            │                 │                                     │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# Optional PAT Permissions (for additional automation):
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Build                      │ Read & Execute  │ Trigger/manage pipelines            │
# │ Service Connections        │ Read & Query    │ Verify service connections          │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# Recommended: Set expiration to 90-180 days and rotate regularly
#
# Security Best Practices:
#   - Set expiration to 90-180 days maximum
#   - Rotate tokens regularly before expiration
#   - Use the minimum required permissions
#   - Never commit this file to source control
#
export ADO_PAT_TOKEN=""

# Organization URL (e.g., https://dev.azure.com/myorg)
export ADO_ORGANIZATION_URL=""

# Project name where pipelines and variable groups will be created
export ADO_PROJECT_NAME=""

# =============================================================================
# Azure Billing Configuration (for Subscription Vending)
# =============================================================================
# Billing Account ID (required) - found in Cost Management + Billing
export BILLING_ACCOUNT_ID=""

# Billing Profile ID (optional, for reference)
export BILLING_PROFILE_ID=""

# For MCA (Microsoft Customer Agreement): Use Invoice Section ID
# For EA (Enterprise Agreement): Use Enrollment Account ID
# Only ONE of these should be provided - not both

# Invoice Section ID - for MCA billing (leave empty if using EA)
export INVOICE_SECTION_ID=""

# Enrollment Account ID - for EA billing (leave empty if using MCA)
export ENROLLMENT_ACCOUNT_ID=""

# =============================================================================
# Variable Group Configuration (for common-variables group)
# =============================================================================
# Name of the Azure service connection in Azure DevOps
# This should match a service connection you've created in your project
export AZURE_SERVICE_CONNECTION_NAME="azure-infra-connection"

# Default deployment location for Azure resources
export DEPLOYMENT_LOCATION="canadacentral"

# Default location code for naming convention (e.g., cac for canadacentral)
export DEFAULT_LOCATION_CODE="cac"

# Default owner for infrastructure resources (e.g., platform team email)
# Leave empty if not applicable
export DEFAULT_OWNER=""

# What manages this infrastructure (typically "Bicep")
export MANAGED_BY="Bicep"

# Default deployment stack deny settings mode
# Controls what operations are blocked on Azure deployment stacks to prevent accidental modifications
# Options:
#   - none: No restrictions (allows all operations)
#   - denyDelete: Prevents deletion of the deployment stack and its resources
#   - denyWriteAndDelete: Prevents both write operations and deletion (most restrictive)
# Effect: When set to denyWriteAndDelete, the deployment stack cannot be modified or deleted
#         without first updating the deny settings. This protects infrastructure from accidental changes.
export DEFAULT_DENY_SETTINGS_MODE="denyWriteAndDelete"

# Default action on unmanaged resources when deployment stack is deleted
# Controls what happens to resources that were previously managed by a deployment stack
# but are no longer included in the stack definition when the stack is deleted
# Options:
#   - deleteResources: Deletes all resources that are no longer in the stack definition
#   - deleteAll: Deletes all resources managed by the stack, regardless of current definition
#   - detachAll: Removes the stack but leaves all resources intact (safest option)
# Effect: When set to detachAll, deleting a deployment stack will not delete any resources,
#         they will simply be detached from stack management. This prevents accidental data loss.
export DEFAULT_ACTION_ON_UNMANAGE="detachAll"

# =============================================================================
# Subscription Names (used by lib.sh)
# =============================================================================
# These names are used to look up subscription IDs dynamically
# Use your actual subscription names (e.g., "subcr-mngmnt-live-cac-001")
export MANAGEMENT_SUBSCRIPTION_NAME=""
export CONNECTIVITY_SUBSCRIPTION_NAME=""

# =============================================================================
# Management Group Configuration
# =============================================================================
# Root management group name (created under Tenant Root Group)
export ROOT_MG_NAME="mg-organization"
export ROOT_MG_DISPLAY_NAME="Organization Root"

# =============================================================================
# Organization Configuration (for mg-hierarchy-variables group)
# =============================================================================
export ORG_NAME=""
export ORG_DISPLAY_NAME=""

# =============================================================================
# Monitoring Configuration (for monitoring-variables group)
# =============================================================================
# Note: Only STRING values go in variable groups. Stable configuration
# (SKU, thresholds, security settings) is defined in bicepparam files.

# Monitoring subscription ID - the subscription where monitoring resources are deployed
# Set this after creating the monitoring subscription via subscription vending
export MONITORING_SUBSCRIPTION_ID=""

# Action Group notification recipients
# Comma-separated email addresses for alert notifications
# Example: "platform-team@example.com,oncall@example.com"
export ACTION_GROUP_EMAILS=""

# Comma-separated SMS numbers for alert notifications (optional)
# Format: "countryCode:phoneNumber" (e.g., "1:5551234567,1:5559876543")
# Leave empty if SMS notifications are not needed
export ACTION_GROUP_SMS_NUMBERS=""

# Note: The following configurations have been moved to bicepparam files:
# - Data retention (dataRetention in monitoring.bicepparam)
# - Workspace SKU (workspaceSku in monitoring.bicepparam)
# - Alert thresholds (dataIngestionThresholdGb, etc. in monitoring.bicepparam)
# - Security settings (publicNetworkAccess in monitoring.bicepparam)

# =============================================================================
# Hub Configuration (for hub-variables group)
# =============================================================================
# Note: Only STRING values go in variable groups. Stable configuration
# (VNet address space, IPAM pool settings) is defined in bicepparam files.
# Runtime values (environment, location, instance) are pipeline parameters.

# Hub/Connectivity subscription ID - the subscription where hub resources are deployed
# Set this after creating the connectivity subscription via subscription vending
export HUB_SUBSCRIPTION_ID=""

# Log Analytics Workspace Resource ID from monitoring infrastructure
# Set this after deploying the monitoring infrastructure
# Format: /subscriptions/{subId}/resourceGroups/{rgName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}
export LOG_ANALYTICS_WORKSPACE_RESOURCE_ID=""

# Organization-wide private DNS zone name
# This is the internal DNS zone for your organization (e.g., internal.contoso.com)
export PRIVATE_DNS_ZONE_NAME="internal.organization.com"

# AVNM (Azure Virtual Network Manager) Management Group ID
# This is the management group where AVNM will have scope for network management
export AVNM_MANAGEMENT_GROUP_ID="mg-connectivity"

# Key Vault Admin Principal ID (optional)
# Object ID of the service principal or user to grant Key Vault Administrator role
# Leave empty to skip Key Vault role assignment
# Find via: az ad sp show --id "<appId>" --query id -o tsv
export KEY_VAULT_ADMIN_PRINCIPAL_ID=""

# Note: The following configurations have been moved to bicepparam files or pipeline parameters:
# - Hub VNet address space (hubVnetAddressSpace in hub.bicepparam)
# - IPAM pool settings (ipamPoolAddressSpace, ipamPoolDescription in hub.bicepparam)
# - Optional resource flags (enableAppGatewayWAF, enableAzureFirewall, etc. as pipeline parameters)
# - VPN configuration (vpnClientAddressPoolPrefix in hub.bicepparam)
# - Azure Firewall tier (azureFirewallTier in hub.bicepparam)

# =============================================================================
# Environment Configuration (for ADO environments and pipeline validation)
# =============================================================================
# List of deployment environments to create in Azure DevOps
# These are used by:
#   - create-environments.sh: Creates ADO environments for deployment jobs
#   - create-common-variables.sh: Stores list in common-variables for pipeline validation
#   - Pipeline Validate stages: Validates environment parameter against this list
#
# Modify this list to match your organization's deployment environments
# Common patterns:
#   - Simple: ("dev" "prod")
#   - Standard: ("dev" "test" "staging" "prod")
#   - Enterprise: ("nonprod" "dev" "test" "uat" "staging" "prod" "live")
ENVIRONMENTS=("nonprod" "dev" "test" "uat" "staging" "prod" "live")
